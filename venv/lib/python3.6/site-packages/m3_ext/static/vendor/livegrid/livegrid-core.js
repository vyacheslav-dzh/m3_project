Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.GridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){if(this.cls){this.cls+=" ext-ux-livegrid"}else{this.cls="ext-ux-livegrid"}Ext.ux.grid.livegrid.GridPanel.superclass.initComponent.call(this)},onRender:function(b,a){Ext.ux.grid.livegrid.GridPanel.superclass.onRender.call(this,b,a);var c=this.getStore();if(c._autoLoad===true){delete c._autoLoad;c.load()}},walkCells:function(h,c,f,e,d){var g=this.store;var a=g.getCount;g.getCount=g.getTotalCount;var b=Ext.ux.grid.livegrid.GridPanel.superclass.walkCells.call(this,h,c,f,e,d);g.getCount=a;return b}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.GridView=function(a){this.addEvents({beforebuffer:true,buffer:true,bufferfailure:true,cursormove:true,abortrequest:true});this.horizontalScrollOffset=17;this._checkEmptyBody=true;Ext.apply(this,a);this.templates={};this.templates.master=new Ext.Template('<div class="x-grid3" hidefocus="true"><div class="liveScroller"><div></div><div></div><div></div></div>','<div class="x-grid3-viewport"">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller" style="overflow-y:hidden !important;"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");this._gridViewSuperclass=Ext.ux.grid.livegrid.GridView.superclass;this._gridViewSuperclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.GridView,Ext.grid.GridView,{hdHeight:0,rowClipped:0,liveScroller:null,liveScrollerInsets:null,rowHeight:-1,visibleRows:1,lastIndex:-1,lastRowIndex:0,lastScrollPos:0,rowIndex:0,isBuffering:false,requestQueue:-1,loadMask:false,loadMaskDisplayed:false,isPrebuffering:false,_loadMaskAnchor:null,reset:function(d){if(d===false){this.ds.modified=[];this.rowIndex=0;this.lastScrollPos=0;this.lastRowIndex=0;this.lastIndex=0;this.adjustVisibleRows();this.adjustScrollerPos(-this.liveScroller.dom.scrollTop,true);this.showLoadMask(false);var b=this.processRows;this.processRows=Ext.emptyFn;this.refresh(true);this.processRows=b;this.processRows(0);this.fireEvent("cursormove",this,0,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return false}else{var c={};var a=this.ds.sortInfo;if(a){c={dir:a.direction,sort:a.field}}return this.ds.load({params:c})}},renderUI:function(){var b=this.grid;var c=b.enableDragDrop||b.enableDrag;b.enableDragDrop=false;b.enableDrag=false;var a=this._gridViewSuperclass.renderUI.call(this);var b=this.grid;b.enableDragDrop=c;b.enableDrag=c;if(c){this.dragZone=new Ext.ux.grid.livegrid.DragZone(b,{ddGroup:b.ddGroup||"GridDD"})}return a},afterRenderUI:function(){this._gridViewSuperclass.afterRenderUI.call(this);if(this.loadMask){this._loadMaskAnchor=Ext.get(this.mainBody.dom.parentNode.parentNode);Ext.apply(this.loadMask,{msgCls:"x-mask-loading"});this._loadMaskAnchor.mask(this.loadMask.msg,this.loadMask.msgCls);var b=this._loadMaskAnchor.dom;var a=Ext.Element.data;a(b,"mask").addClass("ext-ux-livegrid");a(b,"mask").setDisplayed(false);a(b,"maskMsg").setDisplayed(false)}},init:function(a){this._gridViewSuperclass.init.call(this,a);a.on("expand",this._onExpand,this)},initData:function(b,a){if(this.ds){this.ds.un("bulkremove",this.onBulkRemove,this);this.ds.un("beforeload",this.onBeforeLoad,this)}if(b){b.on("bulkremove",this.onBulkRemove,this);b.on("beforeload",this.onBeforeLoad,this)}this._gridViewSuperclass.initData.call(this,b,a)},renderBody:function(){var a=this.renderRows(0,this.visibleRows-1);return this.templates.body.apply({rows:a})},doRender:function(c,b,e,a,d,f){return this._gridViewSuperclass.doRender.call(this,c,b,e,a+this.ds.bufferRange[0],d,f)},initElements:function(){var e=Ext.Element;var b=this.grid.getGridEl().dom.firstChild;var a=b.childNodes;this.el=new e(b);this.mainWrap=new e(a[1]);this.liveScroller=new e(a[0]);var d=this.liveScroller.dom.firstChild;this.liveScrollerInsets=[d,d.nextSibling,d.nextSibling.nextSibling];this.liveScroller.on("scroll",this.onLiveScroll,this,{buffer:this.scrollDelay});var c=this.mainWrap.dom.firstChild;this.mainHd=new e(c);this.hdHeight=c.offsetHeight;this.innerHd=this.mainHd.dom.firstChild;this.scroller=new e(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle("overflow-x","hidden")}this.mainBody=new e(this.scroller.dom.firstChild);this.mainBody.on("mousewheel",this.handleWheel,this);this.focusEl=new e(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",true);this.resizeMarker=new e(a[2]);this.resizeProxy=new e(a[3])},layout:function(){if(!this.mainBody){return}var f=this.grid;var i=f.getGridEl(),k=this.cm,b=f.autoExpandColumn,a=this;var d=i.getSize(true);var j=d.width;if(!f.hideHeaders&&j<20||d.height<20){return}if(f.autoHeight){this.scroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static"}}else{if(this.grid.groupingToolBar!=undefined){d.height=d.height-this.grid.groupingToolBar.getHeight()}else{d.height=d.height}this.el.setSize(d.width,d.height);var h=this.mainHd.getHeight();var e=d.height-(h);this.scroller.setSize(j,e);if(this.innerHd){this.innerHd.style.width=(j)+"px"}}this.liveScroller.dom.style.top=this.hdHeight+"px";if(this.forceFit){if(this.lastViewWidth!=j){this.fitColumns(false,false);this.lastViewWidth=j}}else{this.autoExpand()}this.adjustVisibleRows();this.adjustBufferInset();this.onLayout(j,e)},removeRow:function(a){Ext.removeNode(this.getRow(a))},removeRows:function(c,a){var b=this.mainBody.dom;for(var d=c;d<=a;d++){Ext.removeNode(b.childNodes[c])}},_onExpand:function(a){this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*this.rowIndex,true)},onColumnMove:function(a,c,b){this.indexMap=null;this.replaceLiveRows(this.rowIndex,true);this.updateHeaders();this.updateHeaderSortState();this.afterMove(b);this.grid.fireEvent("columnmove",c,b)},onColumnWidthUpdated:function(c,a,b){this.adjustVisibleRows();this.adjustBufferInset()},onAllColumnWidthsUpdated:function(a,b){this.adjustVisibleRows();this.adjustBufferInset()},onRowSelect:function(a){if(a<this.rowIndex||a>this.rowIndex+this.visibleRows){return}this.addRowClass(a,this.selectedRowClass)},onRowDeselect:function(a){if(a<this.rowIndex||a>this.rowIndex+this.visibleRows){return}this.removeRowClass(a,this.selectedRowClass)},onClear:function(){this.reset(false)},onBulkRemove:function(m,n){var h=null;var k=0;var p=0;var l=n.length;var a=false;var j=false;var f=0;if(l==0){return}var c=this.rowIndex;var b=0;var e=0;var d=0;for(var g=0;g<l;g++){h=n[g][0];k=n[g][1];p=(k!=Number.MIN_VALUE&&k!=Number.MAX_VALUE)?k+this.ds.bufferRange[0]:k;if(p<this.rowIndex){b++}else{if(p>=this.rowIndex&&p<=this.rowIndex+(this.visibleRows-1)){d++}else{if(p>=this.rowIndex+this.visibleRows){e++}}}this.fireEvent("beforerowremoved",this,p,h);this.fireEvent("rowremoved",this,p,h)}var o=this.ds.totalLength;this.rowIndex=Math.max(0,Math.min(this.rowIndex-b,o-(this.visibleRows-1)));this.lastRowIndex=this.rowIndex;this.adjustScrollerPos(-(b*this.rowHeight),true);this.updateLiveRows(this.rowIndex,true);this.adjustBufferInset();this.processRows(0,undefined,false)},onRemove:function(c,a,b){this.onBulkRemove(c,[[a,b]])},onAdd:function(b,c,g){if(this._checkEmptyBody){if(this.mainBody.dom.innerHTML=="&nbsp;"){this.mainBody.dom.innerHTML=""}this._checkEmptyBody=false}var f=c.length;if(g==Number.MAX_VALUE||g==Number.MIN_VALUE){this.fireEvent("beforerowsinserted",this,g,g);if(g==Number.MIN_VALUE){this.rowIndex=this.rowIndex+f;this.lastRowIndex=this.rowIndex;this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*f,true);this.fireEvent("rowsinserted",this,g,g,f);this.processRows(0,undefined,false);this.fireEvent("cursormove",this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return}this.adjustBufferInset();this.fireEvent("rowsinserted",this,g,g,f);return}var a=g+this.ds.bufferRange[0];var e=a+(f-1);var h=this.getRows().length;var d=0;var i=0;if(a>this.rowIndex+(this.visibleRows-1)){this.fireEvent("beforerowsinserted",this,a,e);this.fireEvent("rowsinserted",this,a,e,f);this.adjustVisibleRows();this.adjustBufferInset()}else{if(a>=this.rowIndex&&a<=this.rowIndex+(this.visibleRows-1)){d=g;i=g+(f-1);this.lastRowIndex=this.rowIndex;this.rowIndex=(a>this.rowIndex)?this.rowIndex:a;this.insertRows(b,d,i);if(this.lastRowIndex!=this.rowIndex){this.fireEvent("cursormove",this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}this.adjustVisibleRows();this.adjustBufferInset()}else{if(a<this.rowIndex){this.fireEvent("beforerowsinserted",this,a,e);this.rowIndex=this.rowIndex+f;this.lastRowIndex=this.rowIndex;this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*f,true);this.fireEvent("rowsinserted",this,a,e,f);this.processRows(0,undefined,true);this.fireEvent("cursormove",this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}}}},onBeforeLoad:function(b,c){var d=b.proxy;if(d.activeRequest&&d.activeRequest[Ext.data.Api.actions.read]){d.getConnection().abort(d.activeRequest[Ext.data.Api.actions.read])}this.fireEvent("abortrequest",b,c);this.isBuffering=false;this.isPreBuffering=false;c.params=c.params||{};var a=Ext.apply;a(c,{scope:this,callback:function(){this.reset(false)},suspendLoadEvent:false});a(c.params,{start:0,limit:this.ds.bufferSize});return true},onLoad:function(c,b,a){this.adjustBufferInset()},onDataChange:function(a){this.updateHeaderSortState()},liveBufferUpdate:function(a,b,d){if(d===true){this.adjustBufferInset();this.fireEvent("buffer",this,this.ds,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,b);this.grid.selModel.replaceSelections(a);this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false);if(this.requestQueue>=0){var c=this.requestQueue;this.requestQueue=-1;this.updateLiveRows(c);return}if(this.isInRange(this.rowIndex)){this.replaceLiveRows(this.rowIndex,b.forceRepaint)}else{this.updateLiveRows(this.rowIndex)}return}else{this.fireEvent("bufferfailure",this,this.ds,b)}this.requestQueue=-1;this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false)},handleWheel:function(a){if(this.rowHeight==-1){a.stopEvent();return}var b=a.getWheelDelta();this.adjustScrollerPos(-(b*this.rowHeight));a.stopEvent()},onLiveScroll:function(){var a=this.liveScroller.dom.scrollTop;var b=Math.floor((a)/this.rowHeight);this.rowIndex=b;if(b==this.lastRowIndex){return}this.updateLiveRows(b);this.lastScrollPos=this.liveScroller.dom.scrollTop},refreshRow:function(a){var d=this.ds,c;if(typeof a=="number"){c=a;a=d.getAt(c)}else{c=d.indexOf(a)}var b=c+this.ds.bufferRange[0];if(b<this.rowIndex||b>=this.rowIndex+this.visibleRows){this.fireEvent("rowupdated",this,b,a);return}this.insertRows(d,c,c,true);this.fireEvent("rowupdated",this,b,a)},processRows:function(f,d,a){if(!this.ds||this.ds.getCount()<1){return}d=d||!this.grid.stripeRows;var g=this.rowIndex;var i=this.getRows();var c=0;var h=null;for(var e=0,b=i.length;e<b;e++){h=i[e];h.rowIndex=c=g+e;h.className=h.className.replace(this.rowClsRe," ");if(!d&&(c+1)%2===0){h.className+=" x-grid3-row-alt"}if(a!==false){if(this.grid.selModel.isSelected(this.ds.getAt(c))===true){this.addRowClass(c,this.selectedRowClass)}else{this.removeRowClass(c,this.selectedRowClass)}this.fly(h).removeClass("x-grid3-row-over")}}if(g===0){Ext.fly(i[0]).addClass(this.firstRowCls)}else{if(g+i.length==this.ds.totalLength){Ext.fly(i[i.length-1]).addClass(this.lastRowCls)}}},insertRows:function(e,b,n,m){var a=b+this.ds.bufferRange[0];var f=n+this.ds.bufferRange[0];if(!m){this.fireEvent("beforerowsinserted",this,a,f)}if(m!==true&&(this.getRows().length+(n-b))>=this.visibleRows){this.removeRows((this.visibleRows-1)-(n-b),this.visibleRows-1)}else{if(m){this.removeRows(a-this.rowIndex,f-this.rowIndex)}}var g=(b==n)?n:Math.min(n,(this.rowIndex-this.ds.bufferRange[0])+(this.visibleRows-1));var d=this.renderRows(b,g);var j=this.getRow(a);if(j){Ext.DomHelper.insertHtml("beforeBegin",j,d)}else{Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,d)}if(m===true){var l=this.getRows();var k=this.rowIndex;for(var c=0,h=l.length;c<h;c++){l[c].rowIndex=k+c}}if(!m){this.fireEvent("rowsinserted",this,a,f,(f-a)+1);this.processRows(0,undefined,true)}},getRow:function(a){if(a-this.rowIndex<0){return null}return this.getRows()[a-this.rowIndex]},getCell:function(b,a){var b=this.getRow(b);return b?b.getElementsByTagName("td")[a]:null},focusCell:function(d,a,c){var b=this.ensureVisible(d,a,c);if(!b){return}this.focusEl.setXY(b);if(Ext.isGecko){this.focusEl.focus()}else{this.focusEl.focus.defer(1,this.focusEl)}},ensureVisible:function(l,d,b){if(typeof l!="number"){l=l.rowIndex}if(l<0||l>=this.ds.totalLength){return}d=(d!==undefined?d:0);var i=l-this.rowIndex;if(this.rowClipped&&l==this.rowIndex+this.visibleRows-1){this.adjustScrollerPos(this.rowHeight)}else{if(l>=this.rowIndex+this.visibleRows){this.adjustScrollerPos(((l-(this.rowIndex+this.visibleRows))+1)*this.rowHeight)}else{if(l<=this.rowIndex){this.adjustScrollerPos((i)*this.rowHeight)}}}var h=this.getRow(l),e;if(!h){return}if(!(b===false&&d===0)){while(this.cm.isHidden(d)){d++}e=this.getCell(l,d)}var k=this.scroller.dom;if(b!==false){var j=parseInt(e.offsetLeft,10);var g=j+e.offsetWidth;var f=parseInt(k.scrollLeft,10);var a=f+k.clientWidth;if(j<f){k.scrollLeft=j}else{if(g>a){k.scrollLeft=g-k.clientWidth}}}return e?Ext.fly(e).getXY():[k.scrollLeft+this.el.getX(),Ext.fly(h).getY()]},isRecordRendered:function(a){var b=this.ds.indexOf(a);if(b>=this.rowIndex&&b<this.rowIndex+this.visibleRows){return true}return false},isInRange:function(b){var a=Math.min(this.ds.totalLength-1,b+(this.visibleRows-1));return(b>=this.ds.bufferRange[0])&&(a<=this.ds.bufferRange[1])},getPredictedBufferIndex:function(a,b,c){if(!b){if(a+this.ds.bufferSize>=this.ds.totalLength){return this.ds.totalLength-this.ds.bufferSize}return Math.max(0,(a+this.visibleRows)-Math.round(this.ds.bufferSize/2))}if(!c){return Math.max(0,(a-this.ds.bufferSize)+this.visibleRows)}if(c){return Math.max(0,Math.min(a,this.ds.totalLength-this.ds.bufferSize))}},updateLiveRows:function(g,h,d){var j=this.isInRange(g);if(this.isBuffering){if(this.isPrebuffering){if(j){this.replaceLiveRows(g,h)}else{this.showLoadMask(true)}}this.fireEvent("cursormove",this,g,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);this.requestQueue=g;return}var e=this.lastIndex;this.lastIndex=g;var j=this.isInRange(g);var i=false;if(j&&d!==true){this.replaceLiveRows(g,h);this.fireEvent("cursormove",this,g,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);if(g>e){i=true;var k=this.ds.totalLength;if(g+this.visibleRows+this.nearLimit<=this.ds.bufferRange[1]){return}if(this.ds.bufferRange[1]+1>=k){return}}else{if(g<e){i=false;if(this.ds.bufferRange[0]<=0){return}if(g-this.nearLimit>this.ds.bufferRange[0]){return}}else{return}}this.isPrebuffering=true}this.isBuffering=true;var b=this.getPredictedBufferIndex(g,j,i);if(!j){this.showLoadMask(true)}this.ds.suspendEvents();var f=this.ds.sortInfo;var c={};if(this.ds.lastOptions){Ext.apply(c,this.ds.lastOptions.params)}c.start=b;c.limit=this.ds.bufferSize;if(f){c.dir=f.direction;c.sort=f.field}var a={forceRepaint:h,callback:this.liveBufferUpdate,scope:this,params:c,suspendLoadEvent:true};this.fireEvent("beforebuffer",this,this.ds,g,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,a);this.ds.load(a);this.ds.resumeEvents()},showLoadMask:function(b){if(!this.loadMask||b==this.loadMaskDisplayed){return}var e=this._loadMaskAnchor.dom;var d=Ext.Element.data;var a=d(e,"mask");var c=d(e,"maskMsg");if(b){a.setDisplayed(true);c.setDisplayed(true);c.center(this._loadMaskAnchor);if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&this._loadMaskAnchor.getStyle("height")=="auto"){a.setSize(undefined,this._loadMaskAnchor.getHeight())}}else{a.setDisplayed(false);c.setDisplayed(false)}this.loadMaskDisplayed=b},replaceLiveRows:function(h,g,c){var d=h-this.lastRowIndex;if(d==0&&g!==true){return}var a=d>0;d=Math.abs(d);var b=this.ds.bufferRange;var i=h-b[0];var e=Math.min(i+this.visibleRows-1,b[1]-b[0]);if(d>=this.visibleRows||d==0){this.mainBody.update(this.renderRows(i,e))}else{if(a){this.removeRows(0,d-1);if(i+this.visibleRows-d<=b[1]-b[0]){var f=this.renderRows(i+this.visibleRows-d,e);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,f)}}else{this.removeRows(this.visibleRows-d,this.visibleRows-1);var f=this.renderRows(i,i+d-1);Ext.DomHelper.insertHtml("beforeBegin",this.mainBody.dom.firstChild,f)}}if(c!==false){this.processRows(0,undefined,true)}this.lastRowIndex=h},adjustBufferInset:function(){var l=this.liveScroller.dom;var f=this.grid,b=f.store;var k=f.getGridEl();var o=k.getSize().width;var a=(b.totalLength==this.visibleRows-this.rowClipped)?0:Math.max(0,b.totalLength-(this.visibleRows-this.rowClipped));if(a==0){this.scroller.setWidth(o);l.style.display="none";return}else{this.scroller.setWidth(o-this.getScrollOffset());l.style.display=""}var p=this.cm.getTotalWidth()+this.getScrollOffset()>o;var n=l.parentNode.offsetHeight+((b.totalLength>0&&p)?-this.horizontalScrollOffset:0)-this.hdHeight;l.style.height=Math.max(n,this.horizontalScrollOffset*2)+"px";if(this.rowHeight==-1){return}var e=(a==0?0:n+(a*this.rowHeight));var m=e;var j=this.liveScrollerInsets.length;if(e==0){e=0}else{e=Math.round(e/j)}for(var d=0;d<j;d++){if(d==j-1&&e!=0){e-=(e*3)-m}this.liveScrollerInsets[d].style.height=e+"px"}},adjustVisibleRows:function(){if(this.rowHeight==-1){if(this.getRows()[0]){this.rowHeight=this.getRows()[0].offsetHeight;if(this.rowHeight<=0){this.rowHeight=-1;return}}else{return}}var f=this.grid,d=f.store;var h=f.getGridEl();var j=this.cm;var l=h.getSize();var b=l.width;var e=l.height;if(this.grid.groupingToolBar!=undefined){e-=this.grid.groupingToolBar.getHeight()}var i=b-this.getScrollOffset();if(j.getTotalWidth()>i){e-=this.horizontalScrollOffset}e-=this.mainHd.getHeight();var k=d.totalLength||0;var a=Math.max(1,Math.floor(e/this.rowHeight));this.rowClipped=0;if(k>a&&this.rowHeight/3<(e-(a*this.rowHeight))){a=Math.min(a+1,k);this.rowClipped=1}if(this.visibleRows==a){return}this.visibleRows=a;if(this.isBuffering&&!this.isPrebuffering){return}if(this.rowIndex+(a-this.rowClipped)>k){this.rowIndex=Math.max(0,k-(a-this.rowClipped));this.lastRowIndex=this.rowIndex}this.updateLiveRows(this.rowIndex,true)},adjustScrollerPos:function(d,a){if(d==0){return}var c=this.liveScroller;var b=c.dom;if(a===true){c.un("scroll",this.onLiveScroll,this)}this.lastScrollPos=b.scrollTop;b.scrollTop+=d;if(a===true){b.scrollTop=b.scrollTop;c.on("scroll",this.onLiveScroll,this,{buffer:this.scrollDelay})}}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.JsonReader=function(a,b){Ext.ux.grid.livegrid.JsonReader.superclass.constructor.call(this,a,b)};Ext.extend(Ext.ux.grid.livegrid.JsonReader,Ext.data.JsonReader,{buildExtractors:function(){if(this.ef){return}var a=this.meta;if(a.versionProperty){this.getVersion=this.createAccessor(a.versionProperty)}Ext.ux.grid.livegrid.JsonReader.superclass.buildExtractors.call(this)},readRecords:function(c){if(!this.__readRecords){this.__readRecords=Ext.ux.grid.livegrid.JsonReader.superclass.readRecords}var b=this.__readRecords.call(this,c);if(this.meta.versionProperty){var a=this.getVersion(c);b.version=(a===undefined||a==="")?null:a}return b}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.RowSelectionModel=function(a){this.addEvents({selectiondirty:true});Ext.apply(this,a);this.pendingSelections={};Ext.ux.grid.livegrid.RowSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.RowSelectionModel,Ext.grid.RowSelectionModel,{initEvents:function(){Ext.ux.grid.livegrid.RowSelectionModel.superclass.initEvents.call(this);this.grid.view.on("rowsinserted",this.onAdd,this);this.grid.store.on("selectionsload",this.onSelectionsLoad,this)},onRemove:function(b,d,g){var a=this.getPendingSelections();var c=a.length;var f=false;if(d==Number.MIN_VALUE||d==Number.MAX_VALUE){if(g){if(this.isIdSelected(g.id)&&d==Number.MIN_VALUE){this.shiftSelections(this.grid.store.bufferRange[1],-1)}this.selections.remove(g);f=true}if(d==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0])}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(c!=0){this.fireEvent("selectiondirty",this,d,1)}}else{f=this.isIdSelected(g.id);if(!f){return}this.selections.remove(g);if(c!=0){var h=a[0];var e=a[c-1];if(d<=e||d<=h){this.shiftSelections(d,-1);this.fireEvent("selectiondirty",this,d,1)}}}if(f){this.fireEvent("selectionchange",this)}},onAdd:function(g,e,d,b){var a=this.getPendingSelections();var h=a.length;if((e==Number.MIN_VALUE||e==Number.MAX_VALUE)){if(e==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0]);this.shiftSelections(this.grid.store.bufferRange[1],b)}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(h!=0){this.fireEvent("selectiondirty",this,e,r)}return}var f=a[0];var c=a[h-1];var i=e;if(i<=c||i<=f){this.fireEvent("selectiondirty",this,i,b);this.shiftSelections(i,b)}},shiftSelections:function(m,c){var h=0;var l=0;var b={};var d=this.grid.store;var j=m-d.bufferRange[0];var f=0;var n=this.grid.store.totalLength;var e=null;var a=this.getPendingSelections();var k=a.length;if(k==0){return}for(var g=0;g<k;g++){h=a[g];if(h<m){continue}l=h+c;f=j+c;if(l>=n){break}e=d.getAt(f);if(e){this.selections.add(e)}else{b[l]=true}}this.pendingSelections=b},onSelectionsLoad:function(c,b,a){this.replaceSelections(b)},hasNext:function(){return this.last!==false&&(this.last+1)<this.grid.store.getTotalCount()},getCount:function(){return this.selections.length+this.getPendingSelections().length},isSelected:function(a){if(typeof a=="number"){var b=a;a=this.grid.store.getAt(b);if(!a){var d=this.getPendingSelections().indexOf(b);if(d!=-1){return true}return false}}var c=a;return(c&&this.selections.key(c.id)?true:false)},deselectRecord:function(a,c){if(this.locked){return}var e=this.selections.key(a.id);if(!e){return}var b=this.grid.store;var d=b.indexOfId(a.id);if(d==-1){d=b.findInsertIndex(a);if(d!=Number.MIN_VALUE&&d!=Number.MAX_VALUE){d+=b.bufferRange[0]}}else{delete this.pendingSelections[d]}if(this.last==d){this.last=false}if(this.lastActive==d){this.lastActive=false}this.selections.remove(a);if(!c){this.grid.getView().onRowDeselect(d)}this.fireEvent("rowdeselect",this,d,a);this.fireEvent("selectionchange",this)},deselectRow:function(b,a){if(this.locked){return}if(this.last==b){this.last=false}if(this.lastActive==b){this.lastActive=false}var c=this.grid.store.getAt(b);delete this.pendingSelections[b];if(c){this.selections.remove(c)}if(!a){this.grid.getView().onRowDeselect(b)}this.fireEvent("rowdeselect",this,b,c);this.fireEvent("selectionchange",this)},selectRow:function(b,d,a){if(this.locked||b<0||b>=this.grid.store.getTotalCount()){return}var c=this.grid.store.getAt(b);if(this.fireEvent("beforerowselect",this,b,d,c)!==false){if(!d||this.singleSelect){this.clearSelections()}if(c){this.selections.add(c);delete this.pendingSelections[b]}else{this.pendingSelections[b]=true}this.last=this.lastActive=b;if(!a){this.grid.getView().onRowSelect(b)}this.fireEvent("rowselect",this,b,c);this.fireEvent("selectionchange",this)}},clearPendingSelections:function(g,f){if(f==undefined){f=Number.MAX_VALUE}var b={};var a=this.getPendingSelections();var d=a.length;var c=0;for(var e=0;e<d;e++){c=a[e];if(c<=f&&c>=g){continue}b[c]=true}this.pendingSelections=b},replaceSelections:function(e){if(!e||e.length==0){return}var d=this.grid.store;var f=null;var j=[];var a=this.getPendingSelections();var k=a.length;var c=this.selections;var h=0;for(var g=0;g<k;g++){h=a[g];f=d.getAt(h);if(f){c.add(f);j.push(f.id);delete this.pendingSelections[h]}}var b=null;for(g=0,len=e.length;g<len;g++){f=e[g];b=f.id;if(j.indexOf(b)==-1&&c.containsKey(b)){c.add(f)}}},getPendingSelections:function(f){var d=1;var c=[];var b=0;var g=[];for(var e in this.pendingSelections){g.push(parseInt(e))}g.sort(function(i,h){if(i>h){return 1}else{if(i<h){return -1}else{return 0}}});if(!f){return g}var a=g.length;if(a==0){return[]}c[b]=[g[0],g[0]];for(var e=0,a=a-1;e<a;e++){if(g[e+1]-g[e]==1){c[b][1]=g[e+1]}else{b++;c[b]=[g[e+1],g[e+1]]}}return c},clearSelections:function(a){if(this.locked){return}if(a!==true){var d=this.grid.store;var b=this.selections;var c=-1;b.each(function(e){c=d.indexOfId(e.id);if(c!=-1){this.deselectRow(c+d.bufferRange[0])}},this);b.clear();this.pendingSelections={}}else{this.selections.clear();this.pendingSelections={}}this.last=false},selectRange:function(b,a,d){if(this.locked){return}if(!d){this.clearSelections()}if(b<=a){for(var c=b;c<=a;c++){this.selectRow(c,true)}}else{for(var c=b;c>=a;c--){this.selectRow(c,true)}}}});Ext.namespace("Ext.ux.grid.livegrid");Ext.ux.grid.livegrid.Store=function(a){a=a||{};a.remoteSort=true;this._autoLoad=a.autoLoad?true:false;a.autoLoad=false;this.addEvents("bulkremove","versionchange","beforeselectionsload","selectionsload");Ext.ux.grid.livegrid.Store.superclass.constructor.call(this,a);this.totalLength=0;this.bufferRange=[-1,-1];this.on("clear",function(){this.bufferRange=[-1,-1]},this);if(this.url&&!this.selectionsProxy){this.selectionsProxy=new Ext.data.HttpProxy({url:this.url})}};Ext.extend(Ext.ux.grid.livegrid.Store,Ext.data.Store,{version:null,insert:function(d,c){c=[].concat(c);d=d>=this.bufferSize?Number.MAX_VALUE:d;if(d==Number.MIN_VALUE||d==Number.MAX_VALUE){var b=c.length;if(d==Number.MIN_VALUE){this.bufferRange[0]+=b;this.bufferRange[1]+=b}this.totalLength+=b;this.fireEvent("add",this,c,d);return}var f=false;var g=c;if(c.length+d>=this.bufferSize){f=true;g=c.splice(0,this.bufferSize-d)}this.totalLength+=g.length;if(this.bufferRange[0]<=-1){this.bufferRange[0]=0}if(this.bufferRange[1]<(this.bufferSize-1)){this.bufferRange[1]=Math.min(this.bufferRange[1]+g.length,this.bufferSize-1)}for(var e=0,a=g.length;e<a;e++){this.data.insert(d,g[e]);g[e].join(this)}while(this.getCount()>this.bufferSize){this.data.remove(this.data.last())}this.fireEvent("add",this,g,d);if(f==true){this.fireEvent("add",this,c,Number.MAX_VALUE)}},remove:function(b,a){var c=this._getIndex(b);if(c<0){this.totalLength-=1;if(this.pruneModifiedRecords){this.modified.remove(b)}this.bufferRange[0]=Math.max(-1,this.bufferRange[0]-1);this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);if(a!==true){this.fireEvent("remove",this,b,c)}return c}this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);this.data.removeAt(c);if(this.pruneModifiedRecords){this.modified.remove(b)}this.totalLength-=1;if(a!==true){this.fireEvent("remove",this,b,c)}return c},_getIndex:function(a){var b=this.indexOfId(a.id);if(b<0){b=this.findInsertIndex(a)}return b},bulkRemove:function(b){var g=null;var e=[];var d=0;var a=b.length;var f=[];for(var c=0;c<a;c++){g=b[c];f[g.id]=this._getIndex(g)}for(var c=0;c<a;c++){g=b[c];this.remove(g,true);e.push([g,f[g.id]])}this.fireEvent("bulkremove",this,e)},removeAll:function(){this.totalLength=0;this.bufferRange=[-1,-1];this.data.clear();if(this.pruneModifiedRecords){this.modified=[]}this.fireEvent("clear",this)},loadRanges:function(b){var a=b.length;if(a>0&&!this.selectionsProxy.activeRequest[Ext.data.Api.actions.read]&&this.fireEvent("beforeselectionsload",this,b)!==false){var e=this.lastOptions.params;var f={};f.ranges=Ext.encode(b);if(e){if(e.sort){f.sort=e.sort}if(e.dir){f.dir=e.dir}}var c={};for(var d in this.lastOptions){c.i=this.lastOptions.i}c.ranges=f.ranges;this.selectionsProxy.doRequest(Ext.data.Api.actions.read,null,c,this.reader,this.selectionsLoaded,this,c)}},loadSelections:function(a){if(a.length==0){return}this.loadRanges(a)},selectionsLoaded:function(f,b,e){if(this.checkVersionChange(f,b,e)!==false){var d=f.records;for(var c=0,a=d.length;c<a;c++){d[c].join(this)}this.fireEvent("selectionsload",this,f.records,Ext.decode(b.ranges))}else{this.fireEvent("selectionsload",this,[],Ext.decode(b.ranges))}},checkVersionChange:function(d,b,c){if(d&&c!==false){if(d.version!==undefined){var a=this.version;this.version=d.version;if(this.version!==a){return this.fireEvent("versionchange",this,a,this.version)}}}},findInsertIndex:function(a){this.remoteSort=false;var b=Ext.ux.grid.livegrid.Store.superclass.findInsertIndex.call(this,a);this.remoteSort=true;if(this.bufferRange[0]<=0&&b==0){return b}else{if(this.bufferRange[0]>0&&b==0){return Number.MIN_VALUE}else{if(b>=this.bufferSize){return Number.MAX_VALUE}}}return b},sortData:function(c,d){d=d||"ASC";var a=this.fields.get(c).sortType;var b=function(f,e){var h=a(f.data[c]),g=a(e.data[c]);return h>g?1:(h<g?-1:0)};this.data.sort(d,b)},onMetaChange:function(b,a,c){this.version=null;Ext.ux.grid.livegrid.Store.superclass.onMetaChange.call(this,b,a,c)},loadRecords:function(c,a,b){this.checkVersionChange(c,a,b);if(!c){this.bufferRange=[-1,-1]}else{this.bufferRange=[a.params.start,Math.max(0,Math.min((a.params.start+a.params.limit)-1,c.totalRecords-1))]}if(a.suspendLoadEvent===true){this.suspendEvents()}Ext.ux.grid.livegrid.Store.superclass.loadRecords.call(this,c,a,b);if(a.suspendLoadEvent===true){this.resumeEvents()}},getAt:function(a){if(this.bufferRange[0]==-1){return undefined}var b=a-this.bufferRange[0];return this.data.itemAt(b)},clearFilter:function(){},isFiltered:function(){},collect:function(){},createFilterFn:function(){},sum:function(){},filter:function(){},filterBy:function(){},query:function(){},queryBy:function(){},find:function(){},findBy:function(){}});